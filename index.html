<!doctype html><meta charset="utf-8"/>
<title>Chain Parable — Diagnostics</title>
<style>
  :root{--bg:#0b0c10;--fg:#d9dee7}
  html,body{margin:0;background:var(--bg);color:var(--fg);font:15px/1.5 ui-monospace,monospace;height:100%}
  #ui{position:fixed;left:0;right:0;top:0;padding:10px 12px;background:linear-gradient(var(--bg),rgba(11,12,16,0.35));z-index:10}
  button{background:#1a1f29;color:var(--fg);border:1px solid #2a2f3a;border-radius:6px;padding:6px 10px;cursor:pointer}
  textarea{background:#0f1115;color:var(--fg);border:1px solid #2a2f3a;border-radius:6px;padding:8px;width:100%}
  canvas{position:fixed;inset:0;display:block;width:100vw;height:100vh;z-index:0}
  #log{white-space:pre-wrap;font-size:12px;opacity:.8;margin-top:6px}
</style>
<div id="ui">
  <button id="start">Start</button>
  <button id="self">Run Self-Test</button>
  <button id="reset">Reset</button>
  <span id="hud"></span>
  <div id="log"></div>
</div>
<canvas id="cv"></canvas>
<script>
const cv=document.getElementById('cv'), g=cv.getContext('2d');
const logEl=document.getElementById('log'), hud=document.getElementById('hud');
let rafId=null, started=false, t=0, dpr=1;

function log(msg){ logEl.textContent += msg + "\\n"; }

function fit(){
  dpr = Math.max(1, Math.min(3, (window.devicePixelRatio||1)));
  const w = Math.max(1, Math.floor(window.innerWidth));
  const h = Math.max(1, Math.floor(window.innerHeight));
  cv.style.width = w+'px'; cv.style.height = h+'px';
  cv.width = Math.floor(w*dpr); cv.height = Math.floor(h*dpr);
  g.setTransform(dpr,0,0,dpr,0,0);
  log(`fit: css=${w}x${h} px • dpr=${dpr} • backing=${cv.width}x${cv.height}`);
}
window.addEventListener('resize', fit);

function drawGrid(){
  g.strokeStyle='rgba(255,255,255,0.07)'; g.lineWidth=1;
  for(let x=0;x<window.innerWidth;x+=50){ g.beginPath(); g.moveTo(x,0); g.lineTo(x,window.innerHeight); g.stroke(); }
  for(let y=0;y<window.innerHeight;y+=50){ g.beginPath(); g.moveTo(0,y); g.lineTo(window.innerWidth,y); g.stroke(); }
  g.strokeStyle='rgba(255,255,255,0.25)'; g.strokeRect(0.5,0.5,window.innerWidth-1,window.innerHeight-1);
}

function testPattern(){
  g.fillStyle='rgba(11,12,16,0.25)'; g.fillRect(0,0,window.innerWidth,window.innerHeight);
  drawGrid();
  const cx=window.innerWidth/2, cy=window.innerHeight/2;
  // big pulsing text so you can see it on deploy
  g.font='bold 48px ui-monospace,monospace';
  g.fillStyle='rgba(217,222,231,0.95)';
  const msg='RUNNING';
  const tw=g.measureText(msg).width;
  g.fillText(msg, cx - tw/2, cy - 10);
  // animated ring
  const r=60+40*Math.sin(t/20);
  g.beginPath(); g.arc(cx, cy+30, r, 0, Math.PI*2);
  g.strokeStyle='rgba(217,222,231,0.9)'; g.lineWidth=3; g.stroke();
  // little motes
  const count=200;
  for(let i=0;i<count;i++){
    const a=(i/count)*Math.PI*2 + t/40;
    const rr = 120 + 80*Math.sin((t+i)/30);
    const x=cx+rr*Math.cos(a), y=cy+rr*Math.sin(a);
    g.fillRect(x,y,2,2);
  }
}

let last=performance.now(), fps=0;
function loop(now){
  const dt = now-last; last=now; fps = 1000/dt;
  testPattern();
  hud.textContent = `FPS ${fps.toFixed(0)} • DPR ${dpr}`;
  t++;
  rafId = requestAnimationFrame(loop);
}

function start(){
  if(started) return;
  started=true;
  fit();
  log('start pressed');
  rafId = requestAnimationFrame(loop);
}

function stop(){
  cancelAnimationFrame(rafId);
  started=false;
  log('stopped');
}

document.getElementById('start').onclick = start;
document.getElementById('self').onclick = ()=>{
  if(!started) start(); else log('self-test already running');
};
document.getElementById('reset').onclick = ()=>{
  stop(); fit(); g.clearRect(0,0,cv.width,cv.height); hud.textContent='';
};

</script>



